<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SJ Auto 优质车源</title>
  <!-- Tailwind（开发/预览用；生产建议改本地构建） -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { sjgold: '#FFD700' },
          boxShadow: {
            'gold': '0 10px 25px -5px rgba(255,215,0,0.15), 0 8px 10px -6px rgba(255,215,0,0.08)'
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-black text-sjgold">
  <!-- 顶部导航 -->
  <header class="sticky top-0 z-10 backdrop-blur bg-black/70 border-b border-sjgold/20">
    <nav class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-6 text-sm">
        <a href="index.html" class="opacity-80 hover:opacity-100">返回首页</a>
        <a href="#" class="opacity-60 hover:opacity-100">卖车</a>
        <a href="#" class="opacity-60 hover:opacity-100">租车</a>
      </div>
      <div class="text-xs opacity-70">SJ Auto — 优质车源</div>
    </nav>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 md:py-10">
    <h1 class="text-2xl md:text-3xl font-bold tracking-wide mb-6">在售车源</h1>

    <!-- 车卡列表 -->
    <div id="car-list"
         class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
      <!-- JS 动态填充 -->
    </div>
  </main>

  <script>
    const SHEET_ID = '1ZWlrgY0j4AHPkvJ6MQn7-YAz-zxqnDb_BVtT-d2YGcs';
    const API_KEY  = 'AIzaSyBdYLXN_nYf9S-5SMZ8FG1u89XZgpa1mjc';
    const CLOUD    = 'duwckagtg';

    // 简单格式化：价格/里程
    const fmtPrice   = v => v ? String(v).replace(/(\d)(?=(\d{3})+$)/g, '$1,') : '';
    const fmtMileage = v => v ? `${v} km` : '';

    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1?key=${API_KEY}`)
      .then(res => res.json())
      .then(data => {
        const rows    = data.values || [];
        const headers = rows[0] || [];

        const vinIdx     = headers.indexOf('VIN');
        const statusIdx  = headers.indexOf('Status');
        const yearIdx    = headers.indexOf('Year');
        const makeIdx    = headers.indexOf('Make');
        const modelIdx   = headers.indexOf('Model');
        const mileageIdx = headers.indexOf('Mileage');
        const colorIdx   = headers.indexOf('Color');
        const priceIdx   = headers.indexOf('Price');

        const container = document.getElementById('car-list');

        rows.slice(1).forEach(row => {
          const status = row[statusIdx]?.toLowerCase();
          if (status === 'sold' || status === 'deleted') return;

          const vin    = row[vinIdx];
          const year   = row[yearIdx]   || '';
          const make   = row[makeIdx]   || '';
          const model  = row[modelIdx]  || '';
          const color  = row[colorIdx]  || '';
          const price  = row[priceIdx]  || '';
          const mile   = row[mileageIdx]|| '';

          // 卡片
          const card = document.createElement('article');
          card.className = `
            group bg-neutral-950/70 rounded-2xl ring-1 ring-sjgold/15 shadow-gold
            overflow-hidden flex flex-col hover:ring-sjgold/30 transition
          `;

          // 图
          const imgWrap = document.createElement('div');
          imgWrap.className = 'w-full h-44 sm:h-48 md:h-52 bg-neutral-900 overflow-hidden';
          const img = document.createElement('img');
          img.className = 'w-full h-full object-cover group-hover:scale-[1.02] transition';
          img.alt = `${make} ${model}`;
          img.src = `https://res.cloudinary.com/${CLOUD}/image/upload/${vin}/${vin}main.jpg`;
          // 兜底图
          img.onerror = () => {
            img.src = 'https://placehold.co/800x600/111111/FFD700?text=No+Image';
          };
          imgWrap.appendChild(img);

          // 文字
          const body = document.createElement('div');
          body.className = 'p-4 flex-1 flex flex-col';

          // 标题（年款+品牌+车型）
          const title = document.createElement('h3');
          title.className = 'text-base md:text-lg font-semibold mb-1 line-clamp-1';
          title.textContent = `${year} ${make} ${model}`.trim();

          // 价格突出显示
          const priceEl = document.createElement('div');
          priceEl.className = 'text-lg md:text-xl font-bold text-sjgold/95 mt-1';
          priceEl.textContent = price ? `CAD $${fmtPrice(price)}` : '价格面议';

          // 基本信息（不展示 Detail）
          const meta = document.createElement('div');
          meta.className = 'mt-2 text-sm space-y-1 text-sjgold/80';
          const metaLines = [
            color ? `颜色：${color}` : '',
            mile ? `里程：${fmtMileage(mile)}` : ''
          ].filter(Boolean);
          meta.innerHTML = metaLines.map(t => `<p>${t}</p>`).join('');

          // 按钮
          const btn = document.createElement('button');
          btn.className = `
            mt-4 inline-flex items-center justify-center px-3 py-2 rounded-xl
            bg-sjgold text-black font-semibold hover:brightness-95 active:brightness-90
            ring-1 ring-sjgold/30 shadow-gold transition
          `;
          btn.textContent = '查看详细';
          btn.onclick = () => window.location.href = `detail.html?vin=${vin}`;

          body.appendChild(title);
          body.appendChild(priceEl);
          body.appendChild(meta);
          body.appendChild(btn);

          card.appendChild(imgWrap);
          card.appendChild(body);
          container.appendChild(card);
        });
      })
      .catch(err => {
        console.error('加载表格失败:', err);
        const container = document.getElementById('car-list');
        const tip = document.createElement('div');
        tip.className = 'col-span-full text-center py-12 opacity-80';
        tip.textContent = '车源加载失败，请稍后重试。';
        container.appendChild(tip);
      });
  </script>
</body>
</html>
