<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SJ Auto 优质车源</title>
  <!-- Tailwind（开发/预览用；生产建议改本地构建） -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { sjgold: '#FFD700' },
          boxShadow: {
            gold: '0 10px 25px -5px rgba(255,215,0,0.15), 0 8px 10px -6px rgba(255,215,0,0.08)'
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-black text-sjgold">
  <!-- 顶部导航 -->
  <header class="sticky top-0 z-10 backdrop-blur bg-black/70 border-b border-sjgold/20">
    <nav class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-6 text-sm">
        <a href="index.html" class="opacity-80 hover:opacity-100">返回首页</a>
        <a href="sale.html" class="opacity-60 hover:opacity-100">卖车</a>
      </div>
      <div class="text-xs opacity-70">SJ Auto — 优质车源</div>
    </nav>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 md:py-10">
    <h1 class="text-2xl md:text-3xl font-bold tracking-wide mb-6">在售车源</h1>

    <!-- 车卡列表 -->
    <div id="car-list"
         class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">
      <!-- JS 动态填充 -->
    </div>
  </main>

  <script>
    const BACKEND = 'https://flameauto-write.onrender.com';  // 统一走后端
    const CLOUD   = 'duwckagtg';

    const fmtPrice   = v => v ? String(v).replace(/(\d)(?=(\d{3})+$)/g, '$1,') : '';
    const fmtMileage = v => v ? `${v} km` : '';

    async function loadCars() {
      try {
        const res = await fetch(`${BACKEND}/sheet1`);
        const json = await res.json();
        const rows    = json.values || [];
        const headers = rows[0] || [];
        const body    = rows.slice(1);

        const vinIdx     = headers.indexOf('VIN');
        const statusIdx  = headers.indexOf('Status');
        const yearIdx    = headers.indexOf('Year');
        const makeIdx    = headers.indexOf('Make');
        const modelIdx   = headers.indexOf('Model');
        const mileageIdx = headers.indexOf('Mileage');
        const colorIdx   = headers.indexOf('Color');
        const priceIdx   = headers.indexOf('Price');

        const container = document.getElementById('car-list');
        container.innerHTML = '';

        body.forEach(row => {
          const status = (row[statusIdx] || '').toLowerCase();
          if (status === 'sold' || status === 'deleted') return;

          const vin    = row[vinIdx] || '';
          const year   = row[yearIdx] || '';
          const make   = row[makeIdx] || '';
          const model  = row[modelIdx] || '';
          const color  = row[colorIdx] || '';
          const price  = row[priceIdx] || '';
          const mileage= row[mileageIdx] || '';

          const card = document.createElement('article');
          card.className = `
            group bg-neutral-950/70 rounded-2xl ring-1 ring-sjgold/15 shadow-gold
            overflow-hidden flex flex-col hover:ring-sjgold/30 transition min-w-[240px]
          `;

          // 图
          const imgWrap = document.createElement('div');
          imgWrap.className = 'w-full h-44 sm:h-48 md:h-52 bg-neutral-900 overflow-hidden';
          const img = document.createElement('img');
          img.className = 'w-full h-full object-cover group-hover:scale-[1.02] transition';
          img.alt = `${make} ${model}`;
          img.src = `https://res.cloudinary.com/${CLOUD}/image/upload/${vin}/${vin}main.jpg`;
          img.onerror = () => {
            img.src = 'https://placehold.co/800x600/111111/FFD700?text=No+Image';
          };
          imgWrap.appendChild(img);

          // 信息区：左右两列
          const info = document.createElement('div');
          info.className = 'p-4 flex flex-row gap-3 items-stretch';

          // 左：文案
          const left = document.createElement('div');
          left.className = 'flex-1 min-w-0';
          const title = document.createElement('h3');
          title.className = 'text-base font-semibold mb-1 line-clamp-1';
          title.textContent = `${year} ${make} ${model}`.trim();

          const priceEl = document.createElement('div');
          priceEl.className = 'text-lg font-bold text-sjgold/95';
          priceEl.textContent = price ? `CAD $${fmtPrice(price)}` : '价格面议';

          const meta = document.createElement('div');
          meta.className = 'mt-1 text-sm text-sjgold/80 space-y-1';
          meta.innerHTML = `
            ${color ? `<p class="truncate">颜色：${color}</p>` : ''}
            ${mileage ? `<p class="truncate">里程：${fmtMileage(mileage)}</p>` : ''}
          `;

          left.appendChild(title);
          left.appendChild(priceEl);
          left.appendChild(meta);

          // 右：按钮（强制单行）
          const right = document.createElement('div');
          right.className = 'flex items-start';
          const btn = document.createElement('button');
          btn.className = `
            inline-flex items-center justify-center h-10 px-4 rounded-xl
            bg-sjgold text-black font-semibold text-sm whitespace-nowrap
            hover:brightness-95 active:brightness-90 ring-1 ring-sjgold/30 transition
          `;
          btn.textContent = '查看详细';
          btn.onclick = () => window.location.href = `detail.html?vin=${encodeURIComponent(vin)}`;
          right.appendChild(btn);

          info.appendChild(left);
          info.appendChild(right);

          card.appendChild(imgWrap);
          card.appendChild(info);
          container.appendChild(card);
        });
      } catch (err) {
        console.error('加载表格失败:', err);
        const container = document.getElementById('car-list');
        const tip = document.createElement('div');
        tip.className = 'col-span-full text-center py-12 opacity-80';
        tip.textContent = '车源加载失败，请稍后重试。';
        container.appendChild(tip);
      }
    }

    loadCars();
  </script>
</body>
</html>
