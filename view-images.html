<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SJ Auto · 车辆图片</title>
  <!-- Tailwind（预览/开发用） -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { sjgold: '#FFD700' },
          boxShadow: {
            glow: '0 0 0 1px rgba(255,215,0,0.25), 0 10px 25px -5px rgba(0,0,0,0.5)'
          }
        }
      }
    }
  </script>
  <style>
    :root { --sj: #FFD700; }
    .sj-gold { color: var(--sj); }

    /* 固定图片尺寸容器（不随屏幕变化） */
    .img-box {
      width: 960px;        /* 固定宽度 */
      height: 540px;       /* 固定高度（16:9）*/
      overflow: hidden;
      border-radius: 14px;
      border: 1px solid rgba(255,215,0,.35);
      background: #0a0a0a;
    }
    .img-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      image-rendering: auto;
    }

    /* 横向滚动容器（小屏不压缩图片，允许左右拖动） */
    .hscroll {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    /* 为了在小屏时不被压缩，内部容器最小宽度=图片宽度 */
    .hscroll-inner {
      min-width: 960px;
      display: inline-block;
    }
  </style>
</head>
<body class="min-h-screen bg-black text-neutral-200">
  <!-- 顶部：仅返回审核 -->
  <header class="sticky top-0 z-10 bg-black/70 backdrop-blur border-b border-sjgold/30">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="admin-review.html" class="h-9 inline-flex items-center px-3 rounded-lg bg-sjgold text-black font-semibold hover:brightness-95 active:brightness-90">
        ← 返回审核
      </a>
      <div id="title" class="text-base md:text-lg font-semibold sj-gold">车辆图片</div>
      <div class="text-sm opacity-0 select-none">spacer</div>
    </div>
  </header>

  <!-- 主体 -->
  <main class="mx-auto px-4 py-8 max-w-6xl">
    <div id="meta" class="mb-6 text-sm text-neutral-400">加载中…</div>

    <!-- 固定尺寸图片列表：一张接一张竖排 -->
    <section id="list" class="flex flex-col items-center gap-6">
      <!-- 由 JS 注入 -->
    </section>

    <div id="empty" class="hidden mt-10 text-center text-neutral-400">未找到该 VIN 的图片</div>
  </main>

  <script>
    const BACKEND = 'https://flameauto-write.onrender.com';
    const vin = new URLSearchParams(location.search).get('vin') || '';
    const listEl = document.getElementById('list');
    const emptyEl = document.getElementById('empty');
    const metaEl  = document.getElementById('meta');
    const titleEl = document.getElementById('title');

    titleEl.textContent = vin ? `车辆图片 · ${vin}` : '车辆图片';
    metaEl.textContent = vin ? `VIN：${vin} · 正在获取图片…` : '缺少 VIN 参数';

    if (!vin) {
      emptyEl.classList.remove('hidden');
    } else {
      loadImages(vin);
    }

    async function loadImages(v) {
      try {
        const res = await fetch(`${BACKEND}/cloudinary-search?vin=${encodeURIComponent(v)}`);
        const data = await res.json();

        const items = Array.isArray(data.resources) ? data.resources : [];
        if (!items.length) {
          metaEl.textContent = `VIN：${v}`;
          emptyEl.classList.remove('hidden');
          return;
        }

        // 排序：VINmain -> VIN1..VIN9… -> 其他
        const sorted = items.slice().sort((a, b) => orderKey(a.public_id).localeCompare(orderKey(b.public_id)));

        listEl.innerHTML = '';
        sorted.forEach((r, idx) => {
          const card = document.createElement('article');
          card.className = 'w-full flex flex-col items-center gap-2';

          const labelTop = document.createElement('div');
          labelTop.className = 'text-xs text-neutral-400';
          labelTop.textContent = `${idx + 1}/${sorted.length}`;

          // 横向滚动容器（小屏可左右拖动）
          const hscroll = document.createElement('div');
          hscroll.className = 'hscroll';
          const inner = document.createElement('div');
          inner.className = 'hscroll-inner';

          const box = document.createElement('div');
          box.className = 'img-box shadow-glow';

          const img = document.createElement('img');
          img.loading  = 'lazy';
          img.decoding = 'async';
          img.src      = r.secure_url;
          img.alt      = r.public_id || 'vehicle-image';
          img.onerror  = () => {
            img.src = 'https://placehold.co/960x540/111111/FFD700?text=Image+Unavailable';
          };

          box.appendChild(img);
          inner.appendChild(box);
          hscroll.appendChild(inner);

          const labelBottom = document.createElement('div');
          labelBottom.className = 'text-[11px] text-neutral-500 break-all text-center';
          labelBottom.textContent = r.public_id || '';

          card.appendChild(labelTop);
          card.appendChild(hscroll);
          card.appendChild(labelBottom);
          listEl.appendChild(card);
        });

        metaEl.textContent = `VIN：${v} · 共 ${sorted.length} 张`;
      } catch (e) {
        console.error(e);
        metaEl.textContent = `VIN：${v} · 加载失败`;
        emptyEl.textContent = '加载图片失败，请稍后再试';
        emptyEl.classList.remove('hidden');
      }
    }

    // 生成排序 key：
    //  VINmain → 000_main
    //  VIN1    → 001
    //  VIN10   → 010
    //  其他    → zzz_xxx
    function orderKey(publicId = '') {
      const p = publicId.split('/').pop() || '';
      if (/main$/i.test(p)) return '000_main';
      const m = p.match(/(\d+)$/);
      if (m) return String(m[1]).padStart(3, '0');
      return 'zzz_' + p;
    }
  </script>
</body>
</html>
